!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define("inert",t):t()}(0,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){function n(e,t,i){if(e.nodeType==Node.ELEMENT_NODE){var o=e;t&&t(o);var r=o.shadowRoot;if(r)return void n(r,t,r);if("content"==o.localName){for(var s=o,a=s.getDistributedNodes?s.getDistributedNodes():[],d=0;d<a.length;d++)n(a[d],t,i);return}if("slot"==o.localName){for(var u=o,h=u.assignedNodes?u.assignedNodes({flatten:!0}):[],c=0;c<h.length;c++)n(h[c],t,i);return}}for(var l=e.firstChild;null!=l;)n(l,t,i),l=l.nextSibling}function i(e){if(!e.querySelector("style#inert-style, link#inert-style")){var t=document.createElement("style");t.setAttribute("id","inert-style"),t.textContent="\n[inert] {\n  pointer-events: none;\n  cursor: default;\n}\n\n[inert], [inert] * {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n",e.appendChild(t)}}if("undefined"!=typeof window){var o=Array.prototype.slice,r=Element.prototype.matches||Element.prototype.msMatchesSelector,s=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","details","summary","iframe","object","embed","[contenteditable]"].join(","),a=function(){function i(t,n){e(this,i),this._inertManager=n,this._rootElement=t,this._managedNodes=new Set,this._rootElement.hasAttribute("aria-hidden")?this._savedAriaHidden=this._rootElement.getAttribute("aria-hidden"):this._savedAriaHidden=null,this._rootElement.setAttribute("aria-hidden","true"),this._makeSubtreeUnfocusable(this._rootElement),this._observer=new MutationObserver(this._onMutation.bind(this)),this._observer.observe(this._rootElement,{attributes:!0,childList:!0,subtree:!0})}return t(i,[{key:"destructor",value:function e(){this._observer.disconnect(),this._rootElement&&(null!==this._savedAriaHidden?this._rootElement.setAttribute("aria-hidden",this._savedAriaHidden):this._rootElement.removeAttribute("aria-hidden")),this._managedNodes.forEach(function(e){this._unmanageNode(e.node)},this),this._observer=null,this._rootElement=null,this._managedNodes=null,this._inertManager=null}},{key:"_makeSubtreeUnfocusable",value:function e(t){var i=this;n(t,function(e){return i._visitNode(e)});var o=document.activeElement;if(!document.body.contains(t)){for(var r=t,s=void 0;r;){if(r.nodeType===Node.DOCUMENT_FRAGMENT_NODE){s=r;break}r=r.parentNode}s&&(o=s.activeElement)}t.contains(o)&&(o.blur(),o===document.activeElement&&document.body.focus())}},{key:"_visitNode",value:function e(t){if(t.nodeType===Node.ELEMENT_NODE){var n=t;n!==this._rootElement&&n.hasAttribute("inert")&&this._adoptInertRoot(n),(r.call(n,s)||n.hasAttribute("tabindex"))&&this._manageNode(n)}}},{key:"_manageNode",value:function e(t){var n=this._inertManager.register(t,this);this._managedNodes.add(n)}},{key:"_unmanageNode",value:function e(t){var n=this._inertManager.deregister(t,this);n&&this._managedNodes.delete(n)}},{key:"_unmanageSubtree",value:function e(t){var i=this;n(t,function(e){return i._unmanageNode(e)})}},{key:"_adoptInertRoot",value:function e(t){var n=this._inertManager.getInertRoot(t);n||(this._inertManager.setInert(t,!0),n=this._inertManager.getInertRoot(t)),n.managedNodes.forEach(function(e){this._manageNode(e.node)},this)}},{key:"_onMutation",value:function e(t,n){t.forEach(function(e){var t=e.target;if("childList"===e.type)o.call(e.addedNodes).forEach(function(e){this._makeSubtreeUnfocusable(e)},this),o.call(e.removedNodes).forEach(function(e){this._unmanageSubtree(e)},this);else if("attributes"===e.type)if("tabindex"===e.attributeName)this._manageNode(t);else if(t!==this._rootElement&&"inert"===e.attributeName&&t.hasAttribute("inert")){this._adoptInertRoot(t);var n=this._inertManager.getInertRoot(t);this._managedNodes.forEach(function(e){t.contains(e.node)&&n._manageNode(e.node)})}},this)}},{key:"managedNodes",get:function e(){return new Set(this._managedNodes)}},{key:"hasSavedAriaHidden",get:function e(){return null!==this._savedAriaHidden}},{key:"savedAriaHidden",set:function e(t){this._savedAriaHidden=t},get:function e(){return this._savedAriaHidden}}]),i}(),d=function(){function n(t,i){e(this,n),this._node=t,this._overrodeFocusMethod=!1,this._inertRoots=new Set([i]),this._savedTabIndex=null,this._destroyed=!1,this.ensureUntabbable()}return t(n,[{key:"destructor",value:function e(){if(this._throwIfDestroyed(),this._node&&this._node.nodeType===Node.ELEMENT_NODE){var t=this._node;null!==this._savedTabIndex?t.setAttribute("tabindex",this._savedTabIndex):t.removeAttribute("tabindex"),this._overrodeFocusMethod&&delete t.focus}this._node=null,this._inertRoots=null,this._destroyed=!0}},{key:"_throwIfDestroyed",value:function e(){if(this.destroyed)throw new Error("Trying to access destroyed InertNode")}},{key:"ensureUntabbable",value:function e(){if(this.node.nodeType===Node.ELEMENT_NODE){var t=this.node;if(r.call(t,s)){if(-1===t.tabIndex&&this.hasSavedTabIndex)return;t.hasAttribute("tabindex")&&(this._savedTabIndex=t.tabIndex),t.setAttribute("tabindex","-1"),t.nodeType===Node.ELEMENT_NODE&&(t.focus=function(){},this._overrodeFocusMethod=!0)}else t.hasAttribute("tabindex")&&(this._savedTabIndex=t.tabIndex,t.removeAttribute("tabindex"))}}},{key:"addInertRoot",value:function e(t){this._throwIfDestroyed(),this._inertRoots.add(t)}},{key:"removeInertRoot",value:function e(t){this._throwIfDestroyed(),this._inertRoots.delete(t),0===this._inertRoots.size&&this.destructor()}},{key:"destroyed",get:function e(){return this._destroyed}},{key:"hasSavedTabIndex",get:function e(){return null!==this._savedTabIndex}},{key:"node",get:function e(){return this._throwIfDestroyed(),this._node}},{key:"savedTabIndex",set:function e(t){this._throwIfDestroyed(),this._savedTabIndex=t},get:function e(){return this._throwIfDestroyed(),this._savedTabIndex}}]),n}(),u=function(){function n(t){if(e(this,n),!t)throw new Error("Missing required argument; InertManager needs to wrap a document.");this._document=t,this._managedNodes=new Map,this._inertRoots=new Map,this._observer=new MutationObserver(this._watchForInert.bind(this)),i(t.head||t.body||t.documentElement),"loading"===t.readyState?t.addEventListener("DOMContentLoaded",this._onDocumentLoaded.bind(this)):this._onDocumentLoaded()}return t(n,[{key:"setInert",value:function e(t,n){if(n){if(this._inertRoots.has(t))return;var o=new a(t,this);if(t.setAttribute("inert",""),this._inertRoots.set(t,o),!this._document.body.contains(t))for(var r=t.parentNode;r;)11===r.nodeType&&i(r),r=r.parentNode}else{if(!this._inertRoots.has(t))return;this._inertRoots.get(t).destructor(),this._inertRoots.delete(t),t.removeAttribute("inert")}}},{key:"getInertRoot",value:function e(t){return this._inertRoots.get(t)}},{key:"register",value:function e(t,n){var i=this._managedNodes.get(t);return void 0!==i?i.addInertRoot(n):i=new d(t,n),this._managedNodes.set(t,i),i}},{key:"deregister",value:function e(t,n){var i=this._managedNodes.get(t);return i?(i.removeInertRoot(n),i.destroyed&&this._managedNodes.delete(t),i):null}},{key:"_onDocumentLoaded",value:function e(){o.call(this._document.querySelectorAll("[inert]")).forEach(function(e){this.setInert(e,!0)},this),this._observer.observe(this._document.body||this._document.documentElement,{attributes:!0,subtree:!0,childList:!0})}},{key:"_watchForInert",value:function e(t,n){var i=this;t.forEach(function(e){switch(e.type){case"childList":o.call(e.addedNodes).forEach(function(e){if(e.nodeType===Node.ELEMENT_NODE){var t=o.call(e.querySelectorAll("[inert]"));r.call(e,"[inert]")&&t.unshift(e),t.forEach(function(e){this.setInert(e,!0)},i)}},i);break;case"attributes":if("inert"!==e.attributeName)return;var t=e.target,n=t.hasAttribute("inert");i.setInert(t,n)}},this)}}]),n}();if(!HTMLElement.prototype.hasOwnProperty("inert")){var h=new u(document);Object.defineProperty(HTMLElement.prototype,"inert",{enumerable:!0,get:function e(){return this.hasAttribute("inert")},set:function e(t){h.setInert(this,t)}})}}}()});